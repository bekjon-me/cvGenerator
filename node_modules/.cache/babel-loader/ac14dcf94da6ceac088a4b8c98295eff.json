{"ast":null,"code":"/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\nimport { createPromise } from \"../util\";\nimport { parseColor as utils_parseColor, saveAs as util_saveAs, support } from \"../common\";\nimport * as PDF from \"./core\";\nimport { Group, Path, MultiPath, Gradient, RadialGradient } from '../drawing';\nimport * as geo from \"../geometry\";\nvar DEFAULT_IMAGE_DPI = 300;\nvar TEXT_RENDERING_MODE = PDF.TEXT_RENDERING_MODE;\nvar DASH_PATTERNS = {\n  dash: [4],\n  dashDot: [4, 2, 1, 2],\n  dot: [1, 2],\n  longDash: [8, 2],\n  longDashDot: [8, 2, 1, 2],\n  longDashDotDot: [8, 2, 1, 2, 1, 2],\n  solid: []\n};\nvar LINE_CAP = {\n  butt: 0,\n  round: 1,\n  square: 2\n};\nvar LINE_JOIN = {\n  miter: 0,\n  round: 1,\n  bevel: 2\n};\n\nfunction render(group, callback) {\n  var fonts = [],\n      images = {},\n      options = group.options;\n\n  function getOption(name, defval, hash) {\n    if (!hash) {\n      hash = options;\n    }\n\n    if (hash.pdf && hash.pdf[name] != null) {\n      return hash.pdf[name];\n    }\n\n    return defval;\n  }\n\n  var multiPage = getOption(\"multiPage\");\n  var imgDPI = getOption(\"imgDPI\", DEFAULT_IMAGE_DPI);\n  PDF.clearImageCache();\n  group.traverse(function (element) {\n    dispatch({\n      Image: function (element) {\n        var url = element.src();\n        var size = element.bbox().size;\n\n        if (imgDPI) {\n          var prev = images[url];\n          size = {\n            width: Math.ceil(size.width * imgDPI / 72),\n            height: Math.ceil(size.height * imgDPI / 72)\n          };\n\n          if (prev) {\n            size.width = Math.max(prev.width, size.width);\n            size.height = Math.max(prev.height, size.height);\n          }\n        }\n\n        images[url] = size;\n      },\n      Text: function (element) {\n        var style = PDF.parseFontDef(element.options.font);\n        var url = PDF.getFontURL(style);\n\n        if (fonts.indexOf(url) < 0) {\n          fonts.push(url);\n        }\n      }\n    }, element);\n  });\n\n  function doIt() {\n    if (--count > 0) {\n      return;\n    }\n\n    var pdf = new PDF.Document({\n      producer: getOption(\"producer\"),\n      title: getOption(\"title\"),\n      author: getOption(\"author\"),\n      subject: getOption(\"subject\"),\n      keywords: getOption(\"keywords\"),\n      creator: getOption(\"creator\"),\n      date: getOption(\"date\"),\n      autoPrint: getOption(\"autoPrint\")\n    });\n\n    function drawPage(group) {\n      var options = group.options;\n      var tmp = optimize(group);\n      var bbox = tmp.bbox;\n      group = tmp.root; // var tmp, bbox;\n\n      var paperSize = getOption(\"paperSize\", getOption(\"paperSize\", \"auto\"), options),\n          addMargin = false;\n\n      if (paperSize == \"auto\") {\n        if (bbox) {\n          var size = bbox.getSize();\n          paperSize = [size.width, size.height];\n          addMargin = true;\n          var origin = bbox.getOrigin();\n          tmp = new Group();\n          tmp.transform(new geo.Matrix(1, 0, 0, 1, -origin.x, -origin.y));\n          tmp.append(group);\n          group = tmp;\n        } else {\n          paperSize = \"A4\";\n        }\n      }\n\n      var page;\n      page = pdf.addPage({\n        paperSize: paperSize,\n        margin: getOption(\"margin\", getOption(\"margin\"), options),\n        addMargin: addMargin,\n        landscape: getOption(\"landscape\", getOption(\"landscape\", false), options)\n      });\n      drawElement(group, page, pdf);\n    }\n\n    if (multiPage) {\n      group.children.forEach(drawPage);\n    } else {\n      drawPage(group);\n    }\n\n    callback(pdf.render(), pdf);\n  }\n\n  var count = 2;\n  PDF.loadFonts(fonts, doIt);\n  PDF.loadImages(images, doIt, {\n    jpegQuality: getOption(\"jpegQuality\", 0.92),\n    keepPNG: getOption(\"keepPNG\", false)\n  });\n}\n\nfunction toDataURL(group, callback) {\n  render(group, function (data) {\n    callback(\"data:application/pdf;base64,\" + data.base64());\n  });\n}\n\nfunction toBlob(group, callback) {\n  render(group, function (data) {\n    callback(new window.Blob([data.get()], {\n      type: \"application/pdf\"\n    }));\n  });\n}\n\nfunction saveAs(group, filename, proxy, callback) {\n  // XXX: Safari has Blob, but does not support the download attribute\n  //      so we'd end up converting to dataURL and using the proxy anyway.\n  if (window.Blob && !support.browser.safari) {\n    toBlob(group, function (blob) {\n      util_saveAs({\n        dataURI: blob,\n        fileName: filename\n      });\n\n      if (callback) {\n        callback(blob);\n      }\n    });\n  } else {\n    toDataURL(group, function (dataURL) {\n      util_saveAs({\n        dataURI: dataURL,\n        fileName: filename,\n        proxyURL: proxy\n      });\n\n      if (callback) {\n        callback(dataURL);\n      }\n    });\n  }\n}\n\nfunction dispatch(handlers, element) {\n  var handler = handlers[element.nodeType];\n\n  if (handler) {\n    return handler.call.apply(handler, arguments);\n  }\n\n  return element;\n}\n\nfunction drawElement(element, page, pdf) {\n  if (element.options._pdfDebug) {\n    page.comment(\"BEGIN: \" + element.options._pdfDebug);\n  }\n\n  var transform = element.transform();\n  var opacity = element.opacity();\n  page.save();\n\n  if (opacity != null && opacity < 1) {\n    page.setOpacity(opacity);\n  }\n\n  setStrokeOptions(element, page, pdf);\n  setFillOptions(element, page, pdf);\n\n  if (transform) {\n    var m = transform.matrix();\n    page.transform(m.a, m.b, m.c, m.d, m.e, m.f);\n  }\n\n  setClipping(element, page, pdf);\n  dispatch({\n    Path: drawPath,\n    MultiPath: drawMultiPath,\n    Circle: drawCircle,\n    Arc: drawArc,\n    Text: drawText,\n    Image: drawImage,\n    Group: drawGroup,\n    Rect: drawRect\n  }, element, page, pdf);\n  page.restore();\n\n  if (element.options._pdfDebug) {\n    page.comment(\"END: \" + element.options._pdfDebug);\n  }\n}\n\nfunction setStrokeOptions(element, page) {\n  var stroke = element.stroke && element.stroke();\n\n  if (!stroke) {\n    return;\n  }\n\n  var color = stroke.color;\n\n  if (color) {\n    color = parseColor(color);\n\n    if (color == null) {\n      return; // no stroke\n    }\n\n    page.setStrokeColor(color.r, color.g, color.b);\n\n    if (color.a != 1) {\n      page.setStrokeOpacity(color.a);\n    }\n  }\n\n  var width = stroke.width;\n\n  if (width != null) {\n    if (width === 0) {\n      return; // no stroke\n    }\n\n    page.setLineWidth(width);\n  }\n\n  var dashType = stroke.dashType;\n\n  if (dashType) {\n    page.setDashPattern(DASH_PATTERNS[dashType], 0);\n  }\n\n  var lineCap = stroke.lineCap;\n\n  if (lineCap) {\n    page.setLineCap(LINE_CAP[lineCap]);\n  }\n\n  var lineJoin = stroke.lineJoin;\n\n  if (lineJoin) {\n    page.setLineJoin(LINE_JOIN[lineJoin]);\n  }\n\n  var opacity = stroke.opacity;\n\n  if (opacity != null) {\n    page.setStrokeOpacity(opacity);\n  }\n}\n\nfunction setFillOptions(element, page) {\n  var fill = element.fill && element.fill();\n\n  if (!fill) {\n    return;\n  }\n\n  if (fill instanceof Gradient) {\n    return;\n  }\n\n  var color = fill.color;\n\n  if (color) {\n    color = parseColor(color);\n\n    if (color == null) {\n      return; // no fill\n    }\n\n    page.setFillColor(color.r, color.g, color.b);\n\n    if (color.a != 1) {\n      page.setFillOpacity(color.a);\n    }\n  }\n\n  var opacity = fill.opacity;\n\n  if (opacity != null) {\n    page.setFillOpacity(opacity);\n  }\n}\n\nfunction setClipping(element, page, pdf) {\n  // XXX: only Path supported at the moment.\n  var clip = element.clip();\n\n  if (clip) {\n    _drawPath(clip, page, pdf);\n\n    page.clip(); // page.setStrokeColor(Math.random(), Math.random(), Math.random());\n    // page.setLineWidth(1);\n    // page.stroke();\n  }\n}\n\nfunction shouldDraw(thing) {\n  return thing && (thing instanceof Gradient || thing.color && !/^(none|transparent)$/i.test(thing.color) && (thing.width == null || thing.width > 0) && (thing.opacity == null || thing.opacity > 0));\n}\n\nfunction maybeGradient(element, page, pdf, stroke) {\n  var fill = element.fill();\n\n  if (fill instanceof Gradient) {\n    if (stroke) {\n      page.clipStroke();\n    } else {\n      page.clip();\n    }\n\n    var isRadial = fill instanceof RadialGradient;\n    var start, end;\n\n    if (isRadial) {\n      start = {\n        x: fill.center().x,\n        y: fill.center().y,\n        r: 0\n      };\n      end = {\n        x: fill.center().x,\n        y: fill.center().y,\n        r: fill.radius()\n      };\n    } else {\n      start = {\n        x: fill.start().x,\n        y: fill.start().y\n      };\n      end = {\n        x: fill.end().x,\n        y: fill.end().y\n      };\n    }\n\n    var stops = fill.stops.elements().map(function (stop) {\n      var offset = stop.offset();\n\n      if (/%$/.test(offset)) {\n        offset = parseFloat(offset) / 100;\n      } else {\n        offset = parseFloat(offset);\n      }\n\n      var color = parseColor(stop.color());\n      color.a *= stop.opacity();\n      return {\n        offset: offset,\n        color: color\n      };\n    }); // Duplicats first and last stop to fix\n    // https://github.com/telerik/kendo-ui-core/issues/1782\n\n    stops.unshift(stops[0]);\n    stops.push(stops[stops.length - 1]);\n    var gradient = {\n      userSpace: fill.userSpace(),\n      type: isRadial ? \"radial\" : \"linear\",\n      start: start,\n      end: end,\n      stops: stops\n    };\n    var box = element.rawBBox();\n    var tl = box.topLeft(),\n        size = box.getSize();\n    box = {\n      left: tl.x,\n      top: tl.y,\n      width: size.width,\n      height: size.height\n    };\n    page.gradient(gradient, box);\n    return true;\n  }\n}\n\nfunction maybeFillStroke(element, page, pdf) {\n  if (shouldDraw(element.fill()) && shouldDraw(element.stroke())) {\n    if (!maybeGradient(element, page, pdf, true)) {\n      page.fillStroke();\n    }\n  } else if (shouldDraw(element.fill())) {\n    if (!maybeGradient(element, page, pdf, false)) {\n      page.fill();\n    }\n  } else if (shouldDraw(element.stroke())) {\n    page.stroke();\n  } else {\n    // we should not get here; the path should have been\n    // optimized away.  but let's be prepared.\n    page.nop();\n  }\n}\n\nfunction maybeDrawRect(path, page) {\n  var segments = path.segments;\n\n  if (segments.length == 4 && path.options.closed) {\n    // detect if this path looks like a rectangle parallel to the axis\n    var a = [];\n\n    for (var i = 0; i < segments.length; ++i) {\n      if (segments[i].controlIn()) {\n        // has curve?\n        return false;\n      }\n\n      a[i] = segments[i].anchor();\n    } // it's a rectangle if the y/x/y/x or x/y/x/y coords of\n    // consecutive points are the same.\n\n\n    var isRect = a[0].y == a[1].y && a[1].x == a[2].x && a[2].y == a[3].y && a[3].x == a[0].x || a[0].x == a[1].x && a[1].y == a[2].y && a[2].x == a[3].x && a[3].y == a[0].y;\n\n    if (isRect) {\n      // this saves a bunch of instructions in PDF:\n      // moveTo, lineTo, lineTo, lineTo, close -> rect.\n      page.rect(a[0].x, a[0].y, a[2].x - a[0].x\n      /*width*/\n      , a[2].y - a[0].y\n      /*height*/\n      );\n      return true;\n    }\n  }\n}\n\nfunction _drawPath(element, page, pdf) {\n  var segments = element.segments;\n\n  if (segments.length === 0) {\n    return;\n  }\n\n  if (!maybeDrawRect(element, page, pdf)) {\n    for (var prev, i = 0; i < segments.length; ++i) {\n      var seg = segments[i];\n      var anchor = seg.anchor();\n\n      if (!prev) {\n        page.moveTo(anchor.x, anchor.y);\n      } else {\n        var prevOut = prev.controlOut();\n        var controlIn = seg.controlIn();\n\n        if (prevOut && controlIn) {\n          page.bezier(prevOut.x, prevOut.y, controlIn.x, controlIn.y, anchor.x, anchor.y);\n        } else {\n          page.lineTo(anchor.x, anchor.y);\n        }\n      }\n\n      prev = seg;\n    }\n\n    if (element.options.closed) {\n      page.close();\n    }\n  }\n}\n\nfunction drawPath(element, page, pdf) {\n  _drawPath(element, page, pdf);\n\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawMultiPath(element, page, pdf) {\n  var paths = element.paths;\n\n  for (var i = 0; i < paths.length; ++i) {\n    _drawPath(paths[i], page, pdf);\n  }\n\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawCircle(element, page, pdf) {\n  var g = element.geometry();\n  page.circle(g.center.x, g.center.y, g.radius);\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawArc(element, page, pdf) {\n  var points = element.geometry().curvePoints();\n  page.moveTo(points[0].x, points[0].y);\n\n  for (var i = 1; i < points.length;) {\n    page.bezier(points[i].x, points[i++].y, points[i].x, points[i++].y, points[i].x, points[i++].y);\n  }\n\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawText(element, page) {\n  var style = PDF.parseFontDef(element.options.font);\n  var pos = element._position;\n  var mode;\n\n  if (element.fill() && element.stroke()) {\n    mode = TEXT_RENDERING_MODE.fillAndStroke;\n  } else if (element.fill()) {\n    mode = TEXT_RENDERING_MODE.fill;\n  } else if (element.stroke()) {\n    mode = TEXT_RENDERING_MODE.stroke;\n  }\n\n  page.transform(1, 0, 0, -1, pos.x, pos.y + style.fontSize);\n  page.beginText();\n  page.setFont(PDF.getFontURL(style), style.fontSize);\n  page.setTextRenderingMode(mode);\n  page.showText(element.content(), element._pdfRect ? element._pdfRect.width() : null);\n  page.endText();\n}\n\nfunction drawGroup(element, page, pdf) {\n  if (element._pdfLink) {\n    page.addLink(element._pdfLink.url, element._pdfLink);\n  }\n\n  var children = element.children;\n\n  for (var i = 0; i < children.length; ++i) {\n    drawElement(children[i], page, pdf);\n  }\n}\n\nfunction drawImage(element, page) {\n  var url = element.src();\n\n  if (!url) {\n    return;\n  }\n\n  var rect = element.rect();\n  var tl = rect.getOrigin();\n  var sz = rect.getSize();\n  page.transform(sz.width, 0, 0, -sz.height, tl.x, tl.y + sz.height);\n  page.drawImage(url);\n}\n\nfunction drawRect(element, page, pdf) {\n  var geometry = element.geometry();\n  var ref = geometry.cornerRadius;\n  var rx = ref[0];\n  var ry = ref[1];\n\n  if (rx === 0 && ry === 0) {\n    page.rect(geometry.origin.x, geometry.origin.y, geometry.size.width, geometry.size.height);\n    maybeFillStroke(element, page, pdf);\n  } else {\n    drawPath(Path.fromRect(geometry, element.options), page, pdf);\n  }\n}\n\nfunction parseColor(value) {\n  var color = utils_parseColor(value, true);\n  return color ? color.toRGB() : null;\n}\n\nfunction optimize(root) {\n  var clipbox = false;\n  var matrix = geo.Matrix.unit();\n  var currentBox = null;\n  var changed;\n\n  do {\n    changed = false;\n    root = opt(root);\n  } while (root && changed);\n\n  return {\n    root: root,\n    bbox: currentBox\n  };\n\n  function change(newShape) {\n    changed = true;\n    return newShape;\n  }\n\n  function visible(shape) {\n    return shape.visible() && shape.opacity() > 0 && (shouldDraw(shape.fill()) || shouldDraw(shape.stroke()));\n  }\n\n  function optArray(a) {\n    var b = [];\n\n    for (var i = 0; i < a.length; ++i) {\n      var el = opt(a[i]);\n\n      if (el != null) {\n        b.push(el);\n      }\n    }\n\n    return b;\n  }\n\n  function withClipping(shape, f) {\n    var saveclipbox = clipbox;\n    var savematrix = matrix;\n\n    if (shape.transform()) {\n      matrix = matrix.multiplyCopy(shape.transform().matrix());\n    }\n\n    var clip = shape.clip();\n\n    if (clip) {\n      clip = clip.bbox();\n\n      if (clip) {\n        clip = clip.bbox(matrix);\n        clipbox = clipbox ? geo.Rect.intersect(clipbox, clip) : clip;\n      }\n    }\n\n    try {\n      return f();\n    } finally {\n      clipbox = saveclipbox;\n      matrix = savematrix;\n    }\n  }\n\n  function inClipbox(shape) {\n    if (clipbox == null) {\n      return false;\n    }\n\n    var box = shape.rawBBox().bbox(matrix);\n\n    if (clipbox && box) {\n      box = geo.Rect.intersect(box, clipbox);\n    }\n\n    return box;\n  }\n\n  function opt(shape) {\n    return withClipping(shape, function () {\n      if (!(shape instanceof Group || shape instanceof MultiPath)) {\n        var box = inClipbox(shape);\n\n        if (!box) {\n          return change(null);\n        }\n\n        currentBox = currentBox ? geo.Rect.union(currentBox, box) : box;\n      }\n\n      return dispatch({\n        Path: function (shape) {\n          if (shape.segments.length === 0 || !visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        MultiPath: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          var el = new MultiPath(shape.options);\n          el.paths = optArray(shape.paths);\n\n          if (el.paths.length === 0) {\n            return change(null);\n          }\n\n          return el;\n        },\n        Circle: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Arc: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Text: function (shape) {\n          if (!/\\S/.test(shape.content()) || !visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Image: function (shape) {\n          if (!(shape.visible() && shape.opacity() > 0)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Group: function (shape) {\n          if (!(shape.visible() && shape.opacity() > 0)) {\n            return change(null);\n          }\n\n          var el = new Group(shape.options);\n          el.children = optArray(shape.children);\n          el._pdfLink = shape._pdfLink;\n\n          if (shape !== root && el.children.length === 0 && !shape._pdfLink) {\n            return change(null);\n          }\n\n          return el;\n        },\n        Rect: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        }\n      }, shape);\n    });\n  }\n}\n\nfunction exportPDF(group, options) {\n  var promise = createPromise();\n\n  for (var i in options) {\n    if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n      // This hackish option is set by the page breaking code in drawDOM.  The idea is\n      // that margin is already taken into account there (that's required to do proper\n      // page breaking) and we don't want to set it again here, as it would double the\n      // top-left margin, and truncate the content on bottom/right.\n      continue;\n    }\n\n    group.options.set(\"pdf.\" + i, options[i]);\n  }\n\n  toDataURL(group, promise.resolve);\n  return promise;\n} // XXX: the duplication is in order to keep exportPDF return a data\n// URI, which is what previous versions do.  Currently only IE9 does\n// not support Blob, IMO we should switch to Blob by default\n// everywhere.\n\n\nfunction exportPDFToBlob(group, options) {\n  var promise = createPromise();\n\n  for (var i in options) {\n    if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n      // This hackish option is set by the page breaking code in drawDOM.  The idea is\n      // that margin is already taken into account there (that's required to do proper\n      // page breaking) and we don't want to set it again here, as it would double the\n      // top-left margin, and truncate the content on bottom/right.\n      continue;\n    }\n\n    group.options.set(\"pdf.\" + i, options[i]);\n  }\n\n  if (window.Blob && !support.browser.safari) {\n    toBlob(group, promise.resolve);\n  } else {\n    toDataURL(group, promise.resolve);\n  }\n\n  return promise;\n}\n\nexport { exportPDF, exportPDFToBlob, saveAs, toDataURL, toBlob, render };","map":{"version":3,"sources":["/home/bekjon/Desktop/cvGenerator/node_modules/@progress/kendo-drawing/dist/es/pdf/drawing.js"],"names":["createPromise","parseColor","utils_parseColor","saveAs","util_saveAs","support","PDF","Group","Path","MultiPath","Gradient","RadialGradient","geo","DEFAULT_IMAGE_DPI","TEXT_RENDERING_MODE","DASH_PATTERNS","dash","dashDot","dot","longDash","longDashDot","longDashDotDot","solid","LINE_CAP","butt","round","square","LINE_JOIN","miter","bevel","render","group","callback","fonts","images","options","getOption","name","defval","hash","pdf","multiPage","imgDPI","clearImageCache","traverse","element","dispatch","Image","url","src","size","bbox","prev","width","Math","ceil","height","max","Text","style","parseFontDef","font","getFontURL","indexOf","push","doIt","count","Document","producer","title","author","subject","keywords","creator","date","autoPrint","drawPage","tmp","optimize","root","paperSize","addMargin","getSize","origin","getOrigin","transform","Matrix","x","y","append","page","addPage","margin","landscape","drawElement","children","forEach","loadFonts","loadImages","jpegQuality","keepPNG","toDataURL","data","base64","toBlob","window","Blob","get","type","filename","proxy","browser","safari","blob","dataURI","fileName","dataURL","proxyURL","handlers","handler","nodeType","call","apply","arguments","_pdfDebug","comment","opacity","save","setOpacity","setStrokeOptions","setFillOptions","m","matrix","a","b","c","d","e","f","setClipping","drawPath","drawMultiPath","Circle","drawCircle","Arc","drawArc","drawText","drawImage","drawGroup","Rect","drawRect","restore","stroke","color","setStrokeColor","r","g","setStrokeOpacity","setLineWidth","dashType","setDashPattern","lineCap","setLineCap","lineJoin","setLineJoin","fill","setFillColor","setFillOpacity","clip","_drawPath","shouldDraw","thing","test","maybeGradient","clipStroke","isRadial","start","end","center","radius","stops","elements","map","stop","offset","parseFloat","unshift","length","gradient","userSpace","box","rawBBox","tl","topLeft","left","top","maybeFillStroke","fillStroke","nop","maybeDrawRect","path","segments","closed","i","controlIn","anchor","isRect","rect","seg","moveTo","prevOut","controlOut","bezier","lineTo","close","paths","geometry","circle","points","curvePoints","pos","_position","mode","fillAndStroke","fontSize","beginText","setFont","setTextRenderingMode","showText","content","_pdfRect","endText","_pdfLink","addLink","sz","ref","cornerRadius","rx","ry","fromRect","value","toRGB","clipbox","unit","currentBox","changed","opt","change","newShape","visible","shape","optArray","el","withClipping","saveclipbox","savematrix","multiplyCopy","intersect","inClipbox","union","exportPDF","promise","_ignoreMargin","set","resolve","exportPDFToBlob"],"mappings":"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","sourcesContent":["/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\n\nimport { createPromise } from \"../util\";\nimport { parseColor as utils_parseColor, saveAs as util_saveAs, support } from \"../common\";\nimport * as PDF from \"./core\";\nimport { Group, Path, MultiPath, Gradient, RadialGradient } from '../drawing';\nimport * as geo from \"../geometry\";\n\nvar DEFAULT_IMAGE_DPI = 300;\nvar TEXT_RENDERING_MODE = PDF.TEXT_RENDERING_MODE;\n\nvar DASH_PATTERNS = {\n    dash           : [ 4 ],\n    dashDot        : [ 4, 2, 1, 2 ],\n    dot            : [ 1, 2 ],\n    longDash       : [ 8, 2 ],\n    longDashDot    : [ 8, 2, 1, 2 ],\n    longDashDotDot : [ 8, 2, 1, 2, 1, 2 ],\n    solid          : []\n};\n\nvar LINE_CAP = {\n    butt   : 0,\n    round  : 1,\n    square : 2\n};\n\nvar LINE_JOIN = {\n    miter : 0,\n    round : 1,\n    bevel : 2\n};\n\nfunction render(group, callback) {\n    var fonts = [], images = {}, options = group.options;\n\n    function getOption(name, defval, hash) {\n        if (!hash) {\n            hash = options;\n        }\n        if (hash.pdf && hash.pdf[name] != null) {\n            return hash.pdf[name];\n        }\n        return defval;\n    }\n\n    var multiPage = getOption(\"multiPage\");\n    var imgDPI = getOption(\"imgDPI\", DEFAULT_IMAGE_DPI);\n\n    PDF.clearImageCache();\n\n    group.traverse(function(element){\n        dispatch({\n            Image: function(element) {\n                var url = element.src();\n                var size = element.bbox().size;\n                if (imgDPI) {\n                    var prev = images[url];\n                    size = {\n                      width: Math.ceil(size.width * imgDPI / 72),\n                      height: Math.ceil(size.height * imgDPI / 72)\n                    };\n\n                    if (prev) {\n                      size.width = Math.max(prev.width, size.width);\n                      size.height = Math.max(prev.height, size.height);\n                    }\n                }\n\n                images[url] = size;\n            },\n            Text: function(element) {\n                var style = PDF.parseFontDef(element.options.font);\n                var url = PDF.getFontURL(style);\n                if (fonts.indexOf(url) < 0) {\n                    fonts.push(url);\n                }\n            }\n        }, element);\n    });\n\n    function doIt() {\n        if (--count > 0) {\n            return;\n        }\n\n        var pdf = new (PDF.Document)({\n            producer  : getOption(\"producer\"),\n            title     : getOption(\"title\"),\n            author    : getOption(\"author\"),\n            subject   : getOption(\"subject\"),\n            keywords  : getOption(\"keywords\"),\n            creator   : getOption(\"creator\"),\n            date      : getOption(\"date\"),\n\n            autoPrint : getOption(\"autoPrint\")\n        });\n\n        function drawPage(group) {\n            var options = group.options;\n\n            var tmp = optimize(group);\n            var bbox = tmp.bbox;\n            group = tmp.root;\n            // var tmp, bbox;\n\n            var paperSize = getOption(\"paperSize\", getOption(\"paperSize\", \"auto\"), options), addMargin = false;\n            if (paperSize == \"auto\") {\n                if (bbox) {\n                    var size = bbox.getSize();\n                    paperSize = [ size.width, size.height ];\n                    addMargin = true;\n                    var origin = bbox.getOrigin();\n                    tmp = new Group();\n                    tmp.transform(new geo.Matrix(1, 0, 0, 1, -origin.x, -origin.y));\n                    tmp.append(group);\n                    group = tmp;\n                }\n                else {\n                    paperSize = \"A4\";\n                }\n            }\n\n            var page;\n            page = pdf.addPage({\n                paperSize : paperSize,\n                margin    : getOption(\"margin\", getOption(\"margin\"), options),\n                addMargin : addMargin,\n                landscape : getOption(\"landscape\", getOption(\"landscape\", false), options)\n            });\n            drawElement(group, page, pdf);\n        }\n\n        if (multiPage) {\n            group.children.forEach(drawPage);\n        } else {\n            drawPage(group);\n        }\n\n        callback(pdf.render(), pdf);\n    }\n\n    var count = 2;\n    PDF.loadFonts(fonts, doIt);\n    PDF.loadImages(images, doIt, {\n        jpegQuality : getOption(\"jpegQuality\", 0.92),\n        keepPNG     : getOption(\"keepPNG\", false)\n    });\n}\n\nfunction toDataURL(group, callback) {\n    render(group, function(data){\n        callback(\"data:application/pdf;base64,\" + data.base64());\n    });\n}\n\nfunction toBlob(group, callback) {\n    render(group, function(data){\n        callback(new window.Blob([ data.get() ], { type: \"application/pdf\" }));\n    });\n}\n\nfunction saveAs(group, filename, proxy, callback) {\n    // XXX: Safari has Blob, but does not support the download attribute\n    //      so we'd end up converting to dataURL and using the proxy anyway.\n    if (window.Blob && !support.browser.safari) {\n        toBlob(group, function(blob){\n            util_saveAs({ dataURI: blob, fileName: filename });\n            if (callback) {\n                callback(blob);\n            }\n        });\n    } else {\n        toDataURL(group, function(dataURL){\n            util_saveAs({ dataURI: dataURL, fileName: filename, proxyURL: proxy });\n            if (callback) {\n                callback(dataURL);\n            }\n        });\n    }\n}\n\nfunction dispatch(handlers, element) {\n    var handler = handlers[element.nodeType];\n    if (handler) {\n        return handler.call.apply(handler, arguments);\n    }\n    return element;\n}\n\nfunction drawElement(element, page, pdf) {\n    if (element.options._pdfDebug) {\n        page.comment(\"BEGIN: \" + element.options._pdfDebug);\n    }\n\n    var transform = element.transform();\n    var opacity = element.opacity();\n\n    page.save();\n\n    if (opacity != null && opacity < 1) {\n        page.setOpacity(opacity);\n    }\n\n    setStrokeOptions(element, page, pdf);\n    setFillOptions(element, page, pdf);\n\n    if (transform) {\n        var m = transform.matrix();\n        page.transform(m.a, m.b, m.c, m.d, m.e, m.f);\n    }\n\n    setClipping(element, page, pdf);\n\n    dispatch({\n        Path      : drawPath,\n        MultiPath : drawMultiPath,\n        Circle    : drawCircle,\n        Arc       : drawArc,\n        Text      : drawText,\n        Image     : drawImage,\n        Group     : drawGroup,\n        Rect      : drawRect\n    }, element, page, pdf);\n\n    page.restore();\n\n    if (element.options._pdfDebug) {\n        page.comment(\"END: \" + element.options._pdfDebug);\n    }\n}\n\nfunction setStrokeOptions(element, page) {\n    var stroke = element.stroke && element.stroke();\n    if (!stroke) {\n        return;\n    }\n\n    var color = stroke.color;\n    if (color) {\n        color = parseColor(color);\n        if (color == null) {\n            return; // no stroke\n        }\n        page.setStrokeColor(color.r, color.g, color.b);\n        if (color.a != 1) {\n            page.setStrokeOpacity(color.a);\n        }\n    }\n\n    var width = stroke.width;\n    if (width != null) {\n        if (width === 0) {\n            return; // no stroke\n        }\n        page.setLineWidth(width);\n    }\n\n    var dashType = stroke.dashType;\n    if (dashType) {\n        page.setDashPattern(DASH_PATTERNS[dashType], 0);\n    }\n\n    var lineCap = stroke.lineCap;\n    if (lineCap) {\n        page.setLineCap(LINE_CAP[lineCap]);\n    }\n\n    var lineJoin = stroke.lineJoin;\n    if (lineJoin) {\n        page.setLineJoin(LINE_JOIN[lineJoin]);\n    }\n\n    var opacity = stroke.opacity;\n    if (opacity != null) {\n        page.setStrokeOpacity(opacity);\n    }\n}\n\nfunction setFillOptions(element, page) {\n    var fill = element.fill && element.fill();\n    if (!fill) {\n        return;\n    }\n\n    if (fill instanceof Gradient) {\n        return;\n    }\n\n    var color = fill.color;\n    if (color) {\n        color = parseColor(color);\n        if (color == null) {\n            return; // no fill\n        }\n        page.setFillColor(color.r, color.g, color.b);\n        if (color.a != 1) {\n            page.setFillOpacity(color.a);\n        }\n    }\n\n    var opacity = fill.opacity;\n    if (opacity != null) {\n        page.setFillOpacity(opacity);\n    }\n}\n\nfunction setClipping(element, page, pdf) {\n    // XXX: only Path supported at the moment.\n    var clip = element.clip();\n    if (clip) {\n        _drawPath(clip, page, pdf);\n        page.clip();\n        // page.setStrokeColor(Math.random(), Math.random(), Math.random());\n        // page.setLineWidth(1);\n        // page.stroke();\n    }\n}\n\nfunction shouldDraw(thing) {\n    return (thing &&\n            (thing instanceof Gradient ||\n             (thing.color && !/^(none|transparent)$/i.test(thing.color) &&\n              (thing.width == null || thing.width > 0) &&\n              (thing.opacity == null || thing.opacity > 0))));\n}\n\nfunction maybeGradient(element, page, pdf, stroke) {\n    var fill = element.fill();\n    if (fill instanceof Gradient) {\n        if (stroke) {\n            page.clipStroke();\n        } else {\n            page.clip();\n        }\n        var isRadial = fill instanceof RadialGradient;\n        var start, end;\n        if (isRadial) {\n            start = { x: fill.center().x , y: fill.center().y , r: 0 };\n            end   = { x: fill.center().x , y: fill.center().y , r: fill.radius() };\n        } else {\n            start = { x: fill.start().x , y: fill.start().y };\n            end   = { x: fill.end().x   , y: fill.end().y   };\n        }\n\n        var stops = fill.stops.elements().map(function(stop){\n            var offset = stop.offset();\n            if (/%$/.test(offset)) {\n                offset = parseFloat(offset) / 100;\n            } else {\n                offset = parseFloat(offset);\n            }\n            var color = parseColor(stop.color());\n            color.a *= stop.opacity();\n            return {\n                offset: offset,\n                color: color\n            };\n        });\n\n        // Duplicats first and last stop to fix\n        // https://github.com/telerik/kendo-ui-core/issues/1782\n        stops.unshift(stops[0]);\n        stops.push(stops[stops.length - 1]);\n\n        var gradient = {\n            userSpace : fill.userSpace(),\n            type      : isRadial ? \"radial\" : \"linear\",\n            start     : start,\n            end       : end,\n            stops     : stops\n        };\n        var box = element.rawBBox();\n        var tl = box.topLeft(), size = box.getSize();\n        box = {\n            left   : tl.x,\n            top    : tl.y,\n            width  : size.width,\n            height : size.height\n        };\n        page.gradient(gradient, box);\n        return true;\n    }\n}\n\nfunction maybeFillStroke(element, page, pdf) {\n    if (shouldDraw(element.fill()) && shouldDraw(element.stroke())) {\n        if (!maybeGradient(element, page, pdf, true)) {\n            page.fillStroke();\n        }\n    } else if (shouldDraw(element.fill())) {\n        if (!maybeGradient(element, page, pdf, false)) {\n            page.fill();\n        }\n    } else if (shouldDraw(element.stroke())) {\n        page.stroke();\n    } else {\n        // we should not get here; the path should have been\n        // optimized away.  but let's be prepared.\n        page.nop();\n    }\n}\n\nfunction maybeDrawRect(path, page) {\n    var segments = path.segments;\n    if (segments.length == 4 && path.options.closed) {\n        // detect if this path looks like a rectangle parallel to the axis\n        var a = [];\n        for (var i = 0; i < segments.length; ++i) {\n            if (segments[i].controlIn()) { // has curve?\n                return false;\n            }\n            a[i] = segments[i].anchor();\n        }\n        // it's a rectangle if the y/x/y/x or x/y/x/y coords of\n        // consecutive points are the same.\n        var isRect = (\n            a[0].y == a[1].y && a[1].x == a[2].x && a[2].y == a[3].y && a[3].x == a[0].x\n        ) || (\n            a[0].x == a[1].x && a[1].y == a[2].y && a[2].x == a[3].x && a[3].y == a[0].y\n        );\n        if (isRect) {\n            // this saves a bunch of instructions in PDF:\n            // moveTo, lineTo, lineTo, lineTo, close -> rect.\n            page.rect(a[0].x, a[0].y,\n                      a[2].x - a[0].x /*width*/,\n                      a[2].y - a[0].y /*height*/);\n            return true;\n        }\n    }\n}\n\nfunction _drawPath(element, page, pdf) {\n    var segments = element.segments;\n    if (segments.length === 0) {\n        return;\n    }\n    if (!maybeDrawRect(element, page, pdf)) {\n        for (var prev, i = 0; i < segments.length; ++i) {\n            var seg = segments[i];\n            var anchor = seg.anchor();\n            if (!prev) {\n                page.moveTo(anchor.x, anchor.y);\n            } else {\n                var prevOut = prev.controlOut();\n                var controlIn = seg.controlIn();\n                if (prevOut && controlIn) {\n                    page.bezier(\n                        prevOut.x   , prevOut.y,\n                        controlIn.x , controlIn.y,\n                        anchor.x    , anchor.y\n                    );\n                } else {\n                    page.lineTo(anchor.x, anchor.y);\n                }\n            }\n            prev = seg;\n        }\n        if (element.options.closed) {\n            page.close();\n        }\n    }\n}\n\nfunction drawPath(element, page, pdf) {\n    _drawPath(element, page, pdf);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawMultiPath(element, page, pdf) {\n    var paths = element.paths;\n    for (var i = 0; i < paths.length; ++i) {\n        _drawPath(paths[i], page, pdf);\n    }\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawCircle(element, page, pdf) {\n    var g = element.geometry();\n    page.circle(g.center.x, g.center.y, g.radius);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawArc(element, page, pdf) {\n    var points = element.geometry().curvePoints();\n    page.moveTo(points[0].x, points[0].y);\n    for (var i = 1; i < points.length;) {\n        page.bezier(\n            points[i].x, points[i++].y,\n            points[i].x, points[i++].y,\n            points[i].x, points[i++].y\n        );\n    }\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawText(element, page) {\n    var style = PDF.parseFontDef(element.options.font);\n    var pos = element._position;\n    var mode;\n    if (element.fill() && element.stroke()) {\n        mode = TEXT_RENDERING_MODE.fillAndStroke;\n    } else if (element.fill()) {\n        mode = TEXT_RENDERING_MODE.fill;\n    } else if (element.stroke()) {\n        mode = TEXT_RENDERING_MODE.stroke;\n    }\n\n    page.transform(1, 0, 0, -1, pos.x, pos.y + style.fontSize);\n    page.beginText();\n    page.setFont(PDF.getFontURL(style), style.fontSize);\n    page.setTextRenderingMode(mode);\n    page.showText(element.content(), element._pdfRect ? element._pdfRect.width() : null);\n    page.endText();\n}\n\nfunction drawGroup(element, page, pdf) {\n    if (element._pdfLink) {\n        page.addLink(element._pdfLink.url, element._pdfLink);\n    }\n    var children = element.children;\n    for (var i = 0; i < children.length; ++i) {\n        drawElement(children[i], page, pdf);\n    }\n}\n\nfunction drawImage(element, page) {\n    var url = element.src();\n    if (!url) {\n        return;\n    }\n\n    var rect = element.rect();\n    var tl = rect.getOrigin();\n    var sz = rect.getSize();\n    page.transform(sz.width, 0, 0, -sz.height, tl.x, tl.y + sz.height);\n    page.drawImage(url);\n}\n\nfunction drawRect(element, page, pdf) {\n    var geometry = element.geometry();\n    var ref = geometry.cornerRadius;\n    var rx = ref[0];\n    var ry = ref[1];\n    if (rx === 0 && ry === 0) {\n        page.rect(geometry.origin.x, geometry.origin.y, geometry.size.width, geometry.size.height);\n        maybeFillStroke(element, page, pdf);\n    } else {\n        drawPath(Path.fromRect(geometry, element.options), page, pdf);\n    }\n}\n\nfunction parseColor(value) {\n    var color = utils_parseColor(value, true);\n    return color ? color.toRGB() : null;\n}\n\nfunction optimize(root) {\n    var clipbox = false;\n    var matrix = geo.Matrix.unit();\n    var currentBox = null;\n    var changed;\n    do {\n        changed = false;\n        root = opt(root);\n    } while (root && changed);\n    return { root: root, bbox: currentBox };\n\n    function change(newShape) {\n        changed = true;\n        return newShape;\n    }\n\n    function visible(shape) {\n        return (shape.visible() && shape.opacity() > 0 &&\n                ( shouldDraw(shape.fill()) ||\n                  shouldDraw(shape.stroke()) ));\n    }\n\n    function optArray(a) {\n        var b = [];\n        for (var i = 0; i < a.length; ++i) {\n            var el = opt(a[i]);\n            if (el != null) {\n                b.push(el);\n            }\n        }\n        return b;\n    }\n\n    function withClipping(shape, f) {\n        var saveclipbox = clipbox;\n        var savematrix = matrix;\n\n        if (shape.transform()) {\n            matrix = matrix.multiplyCopy(shape.transform().matrix());\n        }\n\n        var clip = shape.clip();\n        if (clip) {\n            clip = clip.bbox();\n            if (clip) {\n                clip = clip.bbox(matrix);\n                clipbox = clipbox ? geo.Rect.intersect(clipbox, clip) : clip;\n            }\n        }\n\n        try {\n            return f();\n        }\n        finally {\n            clipbox = saveclipbox;\n            matrix = savematrix;\n        }\n    }\n\n    function inClipbox(shape) {\n        if (clipbox == null) {\n            return false;\n        }\n        var box = shape.rawBBox().bbox(matrix);\n        if (clipbox && box) {\n            box = geo.Rect.intersect(box, clipbox);\n        }\n        return box;\n    }\n\n    function opt(shape) {\n        return withClipping(shape, function(){\n            if (!(shape instanceof Group || shape instanceof MultiPath)) {\n                var box = inClipbox(shape);\n                if (!box) {\n                    return change(null);\n                }\n                currentBox = currentBox ? geo.Rect.union(currentBox, box) : box;\n            }\n            return dispatch({\n                Path: function(shape) {\n                    if (shape.segments.length === 0 || !visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                MultiPath: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    var el = new MultiPath(shape.options);\n                    el.paths = optArray(shape.paths);\n                    if (el.paths.length === 0) {\n                        return change(null);\n                    }\n                    return el;\n                },\n                Circle: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Arc: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Text: function(shape) {\n                    if (!/\\S/.test(shape.content()) || !visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Image: function(shape) {\n                    if (!(shape.visible() && shape.opacity() > 0)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Group: function(shape) {\n                    if (!(shape.visible() && shape.opacity() > 0)) {\n                        return change(null);\n                    }\n                    var el = new Group(shape.options);\n                    el.children = optArray(shape.children);\n                    el._pdfLink = shape._pdfLink;\n                    if (shape !== root && el.children.length === 0 && !shape._pdfLink) {\n                        return change(null);\n                    }\n                    return el;\n                },\n                Rect: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                }\n            }, shape);\n        });\n    }\n}\n\nfunction exportPDF(group, options) {\n    var promise = createPromise();\n\n    for (var i in options) {\n        if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n            // This hackish option is set by the page breaking code in drawDOM.  The idea is\n            // that margin is already taken into account there (that's required to do proper\n            // page breaking) and we don't want to set it again here, as it would double the\n            // top-left margin, and truncate the content on bottom/right.\n            continue;\n        }\n        group.options.set(\"pdf.\" + i, options[i]);\n    }\n\n    toDataURL(group, promise.resolve);\n\n    return promise;\n}\n\n// XXX: the duplication is in order to keep exportPDF return a data\n// URI, which is what previous versions do.  Currently only IE9 does\n// not support Blob, IMO we should switch to Blob by default\n// everywhere.\nfunction exportPDFToBlob(group, options) {\n    var promise = createPromise();\n\n    for (var i in options) {\n        if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n            // This hackish option is set by the page breaking code in drawDOM.  The idea is\n            // that margin is already taken into account there (that's required to do proper\n            // page breaking) and we don't want to set it again here, as it would double the\n            // top-left margin, and truncate the content on bottom/right.\n            continue;\n        }\n        group.options.set(\"pdf.\" + i, options[i]);\n    }\n\n    if (window.Blob && !support.browser.safari) {\n        toBlob(group, promise.resolve);\n    } else {\n        toDataURL(group, promise.resolve);\n    }\n\n    return promise;\n}\n\n\nexport { exportPDF, exportPDFToBlob, saveAs, toDataURL, toBlob, render };\n"]},"metadata":{},"sourceType":"module"}